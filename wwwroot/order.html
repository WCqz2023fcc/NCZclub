<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>下单</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="app-container shop-layout">
        <header class="app-header">
            <div class="header-left">
                <h1>商城下单</h1>
            </div>
        </header>

        <!-- 游戏切换栏（和你排行榜同一个位置） -->
        <div class="tab-bar">
            <div class="tab-item active" onclick="switchGame('暗区突围')">暗区突围</div>
            <div class="tab-item" onclick="switchGame('三角洲行动')">三角洲行动</div>
        </div>

        <div class="shop-container">
            <aside class="category-sidebar" id="categorySidebar">
                <div id="categoryList">加载中...</div>
            </aside>

            <main class="product-content">
                <div class="product-grid" id="productGrid">
                    <div class="empty-placeholder">加载商品中...</div>
                </div>
            </main>
        </div>

        <nav class="bottom-nav">
            <div class="nav-item" onclick="location.href='index.html'">首页</div>
            <div class="nav-item active">下单</div>
        </nav>
    </div>

    <script>const GIST_ID = "ef4765e8027d7b3345f66fe47e6f04a4";
const FILE_NAME = "club.json";

let allData = {}; // 三维结构：{游戏:{分类:[[商品]]}}
let currentGame = "暗区突围";

window.onload = async () => {
  await loadOrderData();
  renderAll();
};

async function loadOrderData() {
  try {
    const res = await fetch(`https://api.github.com/gists/${GIST_ID}`);
    const data = await res.json();
    const content = data.files[FILE_NAME].content;
    allData = JSON.parse(content) || {};
  } catch (e) {
    allData = { "暗区突围": {}, "三角洲行动": {} };
  }
}

function switchGame(game) {
  currentGame = game;
  document.querySelectorAll('.tab-item').forEach((t,i)=>{
    t.classList.toggle('active', i==(game=='暗区突围'?0:1));
  });
  renderAll();
}

function renderAll(){
  renderCategories();
  const firstCate = Object.keys(allData[currentGame]||{})[0];
  renderProducts(firstCate);
}

function renderCategories() {
  const listEl = document.getElementById("categoryList");
  const gameData = allData[currentGame] || {};
  const keys = Object.keys(gameData);

  if (keys.length === 0) {
    document.getElementById("categorySidebar").style.display = "none";
    document.getElementById("productGrid").innerHTML = `<div class="empty-placeholder">暂无商品</div>`;
    return;
  }

  document.getElementById("categorySidebar").style.display = "block";
  listEl.innerHTML = "";

  keys.forEach(cate => {
    const div = document.createElement("div");
    div.className = "category-item";
    div.innerText = cate;
    div.onclick = () => renderProducts(cate);
    listEl.appendChild(div);
  });
}

function renderProducts(cate) {
  const grid = document.getElementById("productGrid");
  const gameData = allData[currentGame] || {};
  const list = gameData[cate] || [];

  if (list.length === 0) {
    grid.innerHTML = `<div class="empty-placeholder">该分类暂无商品</div>`;
    return;
  }

  let html = "";
  list.forEach(item => {
    const title = item[0] || "无名商品";
    const desc = item[1] || "";
    const img = item[2] || "";
    const price = item[3] || "0";
    html += `
    <div class="product-card">
      <img src="${img}" class="product-img">
      <div class="product-info">
        <h4 class="product-title">${title}</h4>
        <p class="product-desc">${desc}</p>
        <p class="product-price">¥${price}</p>
      </div>
    </div>
    `;
  });
  grid.innerHTML = html;
}</script>
</body>
</html>
