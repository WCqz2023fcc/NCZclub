<!DOCTYPE html>
<html lang="ZH-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>下单 - 农场主ncz电竞</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <div class="header-left">
                <img src="images/avatar.png" class="header-logo">
                <h1>下单</h1>
            </div>
        </header>

        <main class="main-content">
            <div class="card">
                <h3>订单列表</h3>
                <div id="orderList">
                    <p>暂无订单</p>
                </div>
            </div>

            <div class="card">
                <button id="placeOrderBtn" class="submit-btn">下单</button>
            </div>
        </main>

        <!-- 普通用户导航栏（未登录显示） -->
        <nav class="bottom-nav user-nav">
            <div class="nav-item" onclick="location.href='index.html'">🏠 首页</div>
            <div class="nav-item active" onclick="location.href='order.html'">🛒 下单</div>
        </nav>

        <!-- 自定义下单成功弹窗（紫白配色） -->
        <div id="orderSuccessModal" class="modal custom-modal">
            <div class="modal-content custom-modal-content">
                <h3>下单成功</h3>
                <p>已复制客服微信，请前往微信添加</p>
                <div class="wechat-copy">
                    <span id="wechatId">whale2010925</span>
                    <button id="copyBtn" class="copy-btn">复制</button>
                </div>
                <button id="closeModalBtn" class="close-modal-btn">确定</button>
            </div>
        </div>
    </div>

    <script>
        // 从 Gist 读取订单数据
        const ORDER_GIST_ID = "ef4765e8027d7b3345f66fe47e6f04a4";
        const ORDER_FILE_NAME = "order.json";

        window.addEventListener('load', async () => {
            try {
                const response = await fetch(`https://api.github.com/gists/${ORDER_GIST_ID}`);
                const data = await response.json();
                const orders = JSON.parse(data.files[ORDER_FILE_NAME].content);
                renderOrderList(orders);
            } catch (e) {
                console.error("加载订单数据失败:", e);
                document.getElementById("orderList").innerHTML = "<p>暂无订单</p>";
            }
        });

        // 渲染订单列表
        function renderOrderList(orders) {
            const listEl = document.getElementById("orderList");
            if (!orders || orders.length === 0) {
                listEl.innerHTML = "<p>暂无订单</p>";
                return;
            }
            listEl.innerHTML = orders.map((order, i) => `
                    <div class="order-item">
                        <div class="order-info">
                            <h4>订单 ${i + 1}</h4>
                            <p>状态：${order.status || "待处理"}</p>
                        </div>
                    </div>
                `).join('');
        }

        // 下单按钮点击事件
        document.getElementById("placeOrderBtn").addEventListener('click', () => {
            document.getElementById("orderSuccessModal").style.display = "flex";
        });

        // 复制客服微信
        document.getElementById("copyBtn").addEventListener('click', () => {
            const wechatId = document.getElementById("wechatId").textContent;
            navigator.clipboard.writeText(wechatId).then(() => {
                alert("已复制到剪贴板");
            });
        });

        // 关闭弹窗
        document.getElementById("closeModalBtn").addEventListener('click', () => {
            document.getElementById("orderSuccessModal").style.display = "none";
        });
        window.onclick = e => {
            const modal = document.getElementById("orderSuccessModal");
            if (e.target === modal) {
                modal.style.display = "none";
            }
        };
    </script>
</body>
</html>
